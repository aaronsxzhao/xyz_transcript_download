import{j as e}from"./markdown-vhK0I3xZ.js";import{L as n,r as o}from"./react-vendor-CqdHEJLj.js";import{c as U,i as B,g as Q,a as X,u as K,b as Y,f as G,d as W,e as Z,h as ee,L as $,X as se,R as te,V as f,C as ae,j as re,p as ie}from"./index-DP-uypT4.js";import{T as oe}from"./tag-CzPars92.js";import{M}from"./message-square-DaYXXEWZ.js";import{R as le}from"./refresh-cw-DMpMlfbd.js";import{P as de}from"./plus-0lhVaYd5.js";import{F as j}from"./file-text-BU7NCz9E.js";import"./syntax-D9IAFz2e.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=U("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=U("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),u="xyz_cache_",F="v4",ne=24*60*60*1e3;function A(t){try{const i=localStorage.getItem(`${u}${t}`);if(!i)return null;const r=JSON.parse(i);return r.version!==F?(localStorage.removeItem(`${u}${t}`),null):Date.now()-r.timestamp>ne?(localStorage.removeItem(`${u}${t}`),null):r.data}catch{return null}}function T(t,i){try{const r={data:i,timestamp:Date.now(),version:F};localStorage.setItem(`${u}${t}`,JSON.stringify(r))}catch(r){console.warn("Failed to cache data:",r)}}const p={STATS:"stats",PODCASTS:"podcasts",SUMMARIES:"summaries",SUMMARY:t=>`summary_${t}`,TRANSCRIPT:t=>`transcript_${t}`,EPISODES:t=>`episodes_${t}`};function xe({summary:t}){return e.jsxs(n,{to:`/viewer/${t.episode_id}`,className:"block p-4 bg-dark-surface border border-dark-border rounded-xl hover:border-indigo-500/50 transition-colors",children:[e.jsx("h3",{className:"font-medium text-white line-clamp-2 mb-3",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(oe,{size:14}),e.jsxs("span",{children:[t.topics_count," topics"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(M,{size:14}),e.jsxs("span",{children:[t.key_points_count," points"]})]})]})]})}function me({job:t}){const i=B(t.status);return e.jsxs("div",{className:"p-4 bg-dark-surface border border-dark-border rounded-xl",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Q(t.status,"md"),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.episode_title||`Job ${t.job_id}`}),e.jsx("p",{className:"text-sm text-gray-400",children:t.message})]})]}),e.jsx("span",{className:"text-xs text-gray-500 uppercase",children:t.status})]}),i&&e.jsx("div",{className:"h-2 bg-dark-hover rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${X(t.status)} transition-all duration-300`,style:{width:`${t.progress}%`}})})]})}function ye(){const[t,i]=o.useState(null),[r,x]=o.useState([]),[b,I]=o.useState([]),[D,N]=o.useState(!0),[m,v]=o.useState(""),[y,w]=o.useState(!1),[l,S]=o.useState([]),[g,k]=o.useState(!1),[z,_]=o.useState(!0),{jobs:C,updateJob:L}=K(),{addToast:c}=Y();o.useEffect(()=>{E(),V()},[]);async function E(){const s=A(p.STATS),a=A(p.SUMMARIES);s&&i(s),a&&x(a),(s||a)&&N(!1);try{const[h,R,H]=await Promise.all([G(),W(),Z().catch(()=>({tasks:[]}))]);i(h),x(R),I(H.tasks.filter(J=>J.status==="success").slice(0,6)),T(p.STATS,h),T(p.SUMMARIES,R)}catch(h){console.error("Failed to load data:",h)}finally{N(!1)}}async function V(){try{const s=await ee();S(s.episodes||[])}catch(s){console.error("Failed to load new episodes:",s)}}async function O(){k(!0);try{const s=await re();s.new_episodes>0?(S(s.episodes),_(!0),c({type:"success",title:"New episodes found",message:`Found ${s.new_episodes} new episode(s)`}),E()):c({type:"info",title:"All caught up",message:"No new episodes from subscribed podcasts"})}catch(s){console.error("Failed to check for updates:",s),c({type:"error",title:"Failed to check updates",message:s instanceof Error?s.message:"Unknown error"})}finally{k(!1)}}async function q(s){if(s.preventDefault(),!!m.trim()){w(!0);try{const a=await ie(m);L({job_id:a.job_id,status:"pending",progress:0,message:"Starting...",episode_id:a.episode_id,episode_title:a.episode_title}),v(""),c({type:"success",title:"Processing started",message:"Check the processing panel for progress"})}catch(a){console.error("Failed to start processing:",a),c({type:"error",title:"Failed to start processing",message:a instanceof Error?a.message:"Unknown error"})}finally{w(!1)}}}return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{className:"w-8 h-8 animate-spin text-indigo-500"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-gray-400",children:"Manage your podcasts and video notes"})]}),e.jsxs("button",{onClick:O,disabled:g,className:"flex items-center gap-2 px-3 py-2 bg-dark-surface border border-dark-border rounded-lg hover:bg-dark-hover transition-colors text-sm text-gray-300",title:"Check subscribed podcasts for new episodes",children:[e.jsx(le,{size:16,className:g?"animate-spin":""}),e.jsx("span",{className:"hidden sm:inline",children:g?"Checking...":"Check Updates"})]})]}),z&&l.length>0&&e.jsx("div",{className:"p-4 bg-indigo-900/30 border border-indigo-500/30 rounded-xl",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{className:"w-5 h-5 text-indigo-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-white mb-2",children:[l.length," New Episode",l.length>1?"s":""," Available"]}),e.jsxs("div",{className:"space-y-1",children:[l.slice(0,5).map(s=>e.jsxs(n,{to:`/podcasts/${s.podcast_pid}/episodes`,className:"block text-sm text-gray-300 hover:text-indigo-300 transition-colors",children:[e.jsxs("span",{className:"text-indigo-400",children:[s.podcast_title,":"]})," ",s.title]},s.eid)),l.length>5&&e.jsxs("p",{className:"text-sm text-gray-500",children:["+",l.length-5," more"]})]})]})]}),e.jsx("button",{onClick:()=>_(!1),className:"p-1 text-gray-400 hover:text-white transition-colors",children:e.jsx(se,{size:16})})]})}),e.jsxs("div",{className:"p-4 md:p-6 bg-dark-surface border border-dark-border rounded-xl",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Quick Process"}),e.jsxs("form",{onSubmit:q,className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx("input",{type:"url",value:m,onChange:s=>v(s.target.value),placeholder:"Paste episode URL...",className:"flex-1 px-4 py-3 bg-dark-hover border border-dark-border rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:border-indigo-500 text-base"}),e.jsxs("button",{type:"submit",disabled:y||!m.trim(),className:"flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:[y?e.jsx($,{className:"w-5 h-5 animate-spin"}):e.jsx(de,{className:"w-5 h-5"}),"Process"]})]})]}),t&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 md:gap-4",children:[e.jsx(d,{icon:te,label:"Podcasts",value:t.total_podcasts,color:"text-indigo-500"}),e.jsx(d,{icon:j,label:"Episodes",value:t.total_episodes,color:"text-blue-500"}),e.jsx(d,{icon:j,label:"Transcripts",value:t.total_transcripts,color:"text-green-500"}),e.jsx(d,{icon:M,label:"Summaries",value:t.total_summaries,color:"text-purple-500"}),e.jsx(d,{icon:f,label:"Videos",value:t.total_videos,color:"text-cyan-500"}),e.jsx(d,{icon:ae,label:"Completed",value:t.completed_videos,color:"text-emerald-500"})]}),C.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Processing Queue"}),e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsx(me,{job:s},s.job_id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Recent Summaries"}),e.jsxs(n,{to:"/podcasts",className:"flex items-center gap-1 text-sm text-indigo-400 hover:text-indigo-300",children:["View all ",e.jsx(P,{size:16})]})]}),r.length===0?e.jsxs("div",{className:"p-8 bg-dark-surface border border-dark-border rounded-xl text-center",children:[e.jsx(j,{className:"w-10 h-10 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"No summaries yet"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:r.slice(0,4).map(s=>e.jsx(xe,{summary:s},s.episode_id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Recent Video Notes"}),e.jsxs(n,{to:"/videos",className:"flex items-center gap-1 text-sm text-indigo-400 hover:text-indigo-300",children:["View all ",e.jsx(P,{size:16})]})]}),b.length===0?e.jsxs("div",{className:"p-8 bg-dark-surface border border-dark-border rounded-xl text-center",children:[e.jsx(f,{className:"w-10 h-10 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"No video notes yet"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:b.slice(0,4).map(s=>e.jsx(n,{to:`/videos/${s.id}`,className:"block p-4 bg-dark-surface border border-dark-border rounded-xl hover:border-indigo-500/50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:"",className:"w-16 h-10 rounded object-cover flex-shrink-0 bg-dark-hover",onError:a=>{a.target.style.display="none"},referrerPolicy:"no-referrer"}):e.jsx("div",{className:"w-16 h-10 rounded bg-dark-hover flex items-center justify-center flex-shrink-0",children:e.jsx(f,{size:14,className:"text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-white text-sm truncate",children:s.title||(s.url?(()=>{try{return new URL(s.url).hostname.replace("www.","")+new URL(s.url).pathname.replace(/\/$/,"").slice(0,30)}catch{return"Untitled"}})():"Untitled")}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-0.5",children:[s.status==="failed"&&e.jsx("span",{className:"px-1.5 py-0.5 bg-red-600/20 text-red-400 rounded-full text-[10px]",children:"Failed"}),s.platform&&e.jsx("span",{className:"capitalize",children:s.platform}),s.style&&e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-600/20 text-purple-400 rounded-full text-[10px]",children:s.style})]})]})]})},s.id))})]})]})]})}function d({icon:t,label:i,value:r,color:x}){return e.jsx("div",{className:"p-4 bg-dark-surface border border-dark-border rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-dark-hover ${x}`,children:e.jsx(t,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-white",children:r}),e.jsx("p",{className:"text-xs text-gray-400",children:i})]})]})})}export{ye as default};
