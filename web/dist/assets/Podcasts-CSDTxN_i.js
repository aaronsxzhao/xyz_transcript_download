import{j as e}from"./markdown-vhK0I3xZ.js";import{r as a,L as A}from"./react-vendor-CqdHEJLj.js";import{b as E,k as F,L as x,R as k,T as z,l as L,r as C,m as U}from"./index-DBKQF1e8.js";import{P as w}from"./plus-BdRbatl3.js";import{E as T}from"./external-link-BWvfrgbb.js";import{R as _}from"./refresh-cw-CYmBFy4o.js";import"./syntax-D9IAFz2e.js";function J(){const[d,i]=a.useState([]),[c,m]=a.useState(!0),[l,h]=a.useState(!1),[n,u]=a.useState(""),[f,p]=a.useState(!1),[g,b]=a.useState(null),[j,y]=a.useState(null),{addToast:o,removeToast:N}=E();a.useEffect(()=>{v()},[]);async function v(){try{const s=await F();i(s)}catch(s){console.error("Failed to load podcasts:",s)}finally{m(!1)}}async function P(s){if(s.preventDefault(),!n.trim())return;h(!0);const r=o({type:"loading",title:"Adding podcast...",message:"Fetching podcast information"});try{const t=await L(n);i([t,...d]),u(""),p(!1),N(r),o({type:"success",title:"Podcast added",message:t.title})}catch(t){N(r),o({type:"error",title:"Failed to add podcast",message:t instanceof Error?t.message:"Unknown error"})}finally{h(!1)}}async function R(s){if(!confirm("Remove this podcast?"))return;const r=d.find(t=>t.pid===s);y(s);try{await C(s),i(d.filter(t=>t.pid!==s)),o({type:"success",title:"Podcast removed",message:(r==null?void 0:r.title)||"Podcast unsubscribed"})}catch(t){console.error("Failed to remove podcast:",t),o({type:"error",title:"Failed to remove podcast"})}finally{y(null)}}async function S(s){b(s);try{const r=await U(s);o({type:"success",title:"Podcast refreshed",message:r.message}),v()}catch(r){console.error("Failed to refresh podcast:",r),o({type:"error",title:"Failed to refresh podcast"})}finally{b(null)}}return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(x,{className:"w-8 h-8 animate-spin text-indigo-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-white mb-1 md:mb-2",children:"Podcasts"}),e.jsx("p",{className:"text-sm md:text-base text-gray-400",children:"Manage your subscribed podcasts"})]}),e.jsxs("button",{onClick:()=>p(!f),className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors w-full sm:w-auto",children:[e.jsx(w,{size:20}),"Add Podcast"]})]}),f&&e.jsxs("div",{className:"p-4 md:p-6 bg-dark-surface border border-dark-border rounded-xl",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Add New Podcast"}),e.jsxs("form",{onSubmit:P,className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsx("input",{type:"url",value:n,onChange:s=>u(s.target.value),placeholder:"Paste podcast or episode URL...",className:"flex-1 px-4 py-3 bg-dark-hover border border-dark-border rounded-lg text-white placeholder:text-gray-500 focus:outline-none focus:border-indigo-500 text-base"}),e.jsxs("button",{type:"submit",disabled:l||!n.trim(),className:"flex items-center justify-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:[l?e.jsx(x,{className:"w-5 h-5 animate-spin"}):e.jsx(w,{className:"w-5 h-5"}),"Add"]})]})]}),d.length===0?e.jsxs("div",{className:"p-12 bg-dark-surface border border-dark-border rounded-xl text-center",children:[e.jsx(k,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:"No podcasts yet"}),e.jsx("p",{className:"text-gray-500",children:"Add a podcast to get started"})]}):e.jsx("div",{className:"space-y-4",children:d.map(s=>e.jsx("div",{className:"p-4 md:p-6 bg-dark-surface border border-dark-border rounded-xl hover:border-dark-hover transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0",children:[e.jsx($,{url:s.cover_url,alt:s.title}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-white mb-1 line-clamp-2",children:s.title}),s.author&&e.jsx("p",{className:"text-sm text-gray-400 mb-1 md:mb-2",children:s.author}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2 hidden sm:block",children:s.description||"No description"}),e.jsx("p",{className:"text-sm text-indigo-400 mt-1 md:mt-2",children:s.summarized_count>0?`${s.summarized_count} / ${s.episode_count} summarized`:`${s.episode_count} episodes`})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:[e.jsxs(A,{to:`/podcasts/${s.pid}/episodes`,className:"flex items-center gap-1 px-3 py-2 bg-dark-hover hover:bg-dark-border text-white rounded-lg transition-colors text-sm",children:[e.jsx(T,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Episodes"})]}),e.jsx("button",{onClick:()=>S(s.pid),disabled:g===s.pid,className:"p-2 bg-dark-hover hover:bg-dark-border text-white rounded-lg transition-colors disabled:opacity-50",title:"Refresh episodes",children:e.jsx(_,{size:16,className:g===s.pid?"animate-spin":""})}),e.jsx("button",{onClick:()=>R(s.pid),disabled:j===s.pid,className:"p-2 bg-dark-hover hover:bg-red-600/20 text-red-400 rounded-lg transition-colors disabled:opacity-50",title:"Remove podcast",children:j===s.pid?e.jsx(x,{size:16,className:"animate-spin"}):e.jsx(z,{size:16})})]})]})},s.pid))})]})}function $({url:d,alt:i}){const[c,m]=a.useState(!1);if(!d||c)return e.jsx("div",{className:"w-14 h-14 md:w-20 md:h-20 rounded-lg bg-dark-hover flex items-center justify-center flex-shrink-0",children:e.jsx(k,{className:"w-6 h-6 md:w-8 md:h-8 text-gray-600"})});const l=`/api/image-proxy?url=${encodeURIComponent(d)}`;return e.jsx("img",{src:l,alt:i,className:"w-14 h-14 md:w-20 md:h-20 rounded-lg object-cover bg-dark-hover flex-shrink-0",onError:()=>m(!0)})}export{J as default};
