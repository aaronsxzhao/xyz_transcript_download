import{j as s}from"./markdown-vhK0I3xZ.js";import{e as S,r as i,L as j}from"./react-vendor-CqdHEJLj.js";import{b as F,u as R,n as T,o as C,L as n,C as D,a as L,T as $,p as M,q as A,s as J}from"./index-DP-uypT4.js";import{A as q}from"./arrow-left-CKD6ohh3.js";import{F as U}from"./file-text-BU7NCz9E.js";import{M as V}from"./message-square-DaYXXEWZ.js";import{T as B}from"./tag-CzPars92.js";import{R as G}from"./refresh-cw-DMpMlfbd.js";import{P as H}from"./play-WWGm0TfV.js";import"./syntax-D9IAFz2e.js";function te(){const{pid:l}=S(),[d,b]=i.useState(null),[o,c]=i.useState([]),[y,N]=i.useState(!0),[m,x]=i.useState(null),[u,p]=i.useState(null),[h,g]=i.useState(null),{addToast:r}=F(),{jobs:v,updateJob:f}=R();function w(e){return v.find(t=>t.episode_id===e&&!["completed","failed","cancelled"].includes(t.status))}i.useEffect(()=>{l&&k()},[l]);async function k(){try{const[e,t]=await Promise.all([T(l),C(l)]);b(e),c(t)}catch(e){console.error("Failed to load data:",e)}finally{N(!1)}}async function z(e){x(e.eid);try{const t=`https://www.xiaoyuzhoufm.com/episode/${e.eid}`,a=await M(t);f({job_id:a.job_id,status:"pending",progress:0,message:"Starting...",episode_id:e.eid,episode_title:e.title}),r({type:"success",title:"Processing started",message:e.title})}catch(t){console.error("Failed to start processing:",t),r({type:"error",title:"Failed to start processing"})}finally{x(null)}}async function E(e){p(e.eid);try{const t=await A(e.eid);f({job_id:t.job_id,status:"pending",progress:0,message:"Re-summarizing...",episode_id:e.eid,episode_title:e.title}),r({type:"success",title:"Re-summarization started",message:e.title})}catch(t){console.error("Failed to start re-summarization:",t),r({type:"error",title:"Failed to start re-summarization"})}finally{p(null)}}async function _(e){if(confirm(`Delete "${e.title}"?

This will also delete any transcript and summary.`)){g(e.eid);try{await J(e.eid),c(o.filter(t=>t.eid!==e.eid)),r({type:"success",title:"Episode deleted",message:e.title})}catch(t){console.error("Failed to delete episode:",t),r({type:"error",title:"Failed to delete episode"})}finally{g(null)}}}function P(e){return`${Math.floor(e/60)} min`}return y?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(n,{className:"w-8 h-8 animate-spin text-indigo-500"})}):s.jsxs("div",{className:"space-y-4 md:space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[s.jsx(j,{to:"/podcasts",className:"p-2 bg-dark-surface border border-dark-border rounded-lg hover:bg-dark-hover transition-colors flex-shrink-0",children:s.jsx(q,{size:20})}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("h1",{className:"text-lg md:text-2xl font-bold text-white line-clamp-1",children:(d==null?void 0:d.title)||"Episodes"}),s.jsxs("p",{className:"text-sm md:text-base text-gray-400",children:[o.length," episodes"]})]})]}),s.jsx("div",{className:"space-y-3",children:o.map(e=>{var t;return s.jsx("div",{className:"p-3 md:p-4 bg-dark-surface border border-dark-border rounded-xl hover:border-dark-hover transition-colors",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-3 md:gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-medium text-white mb-1 line-clamp-2 text-sm md:text-base",children:e.title}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-xs md:text-sm text-gray-400",children:[s.jsx("span",{children:(t=e.pub_date)==null?void 0:t.slice(0,10)}),s.jsx("span",{children:P(e.duration)}),e.has_transcript&&s.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[s.jsx(U,{size:12,className:"md:w-3.5 md:h-3.5"}),s.jsx("span",{className:"hidden sm:inline",children:"Transcript"})]}),e.has_summary&&s.jsxs("span",{className:"flex items-center gap-1 text-purple-500",children:[s.jsx(V,{size:12,className:"md:w-3.5 md:h-3.5"}),s.jsx("span",{className:"hidden sm:inline",children:"Summary"}),s.jsxs("span",{className:"text-gray-400 ml-1",children:["(",e.topics_count," ",s.jsx(B,{size:10,className:"inline"}),", ",e.key_points_count," pts)"]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:[(()=>{const a=w(e.eid);return e.has_summary?s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>E(e),disabled:u===e.eid||!!a,className:"flex items-center gap-2 px-3 py-2 bg-dark-hover hover:bg-dark-border text-gray-300 rounded-lg transition-colors disabled:opacity-50",title:"Re-process episode",children:[u===e.eid?s.jsx(n,{size:16,className:"animate-spin"}):s.jsx(G,{size:16}),s.jsx("span",{className:"hidden sm:inline",children:"Re-Process"})]}),s.jsxs(j,{to:`/viewer/${e.eid}`,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:[s.jsx(D,{size:16}),"View"]})]}):a?s.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-dark-hover rounded-lg min-w-[140px]",children:[s.jsx(n,{size:16,className:"animate-spin text-indigo-400"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-gray-400 mb-1",children:a.message||a.status}),s.jsx("div",{className:"h-1.5 bg-dark-border rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${L(a.status)} transition-all duration-300`,style:{width:`${Math.min(a.progress,100)}%`}})})]})]}):s.jsxs("button",{onClick:()=>z(e),disabled:m===e.eid,className:"flex items-center gap-2 px-4 py-2 bg-dark-hover hover:bg-dark-border text-white rounded-lg transition-colors disabled:opacity-50",children:[m===e.eid?s.jsx(n,{size:16,className:"animate-spin"}):s.jsx(H,{size:16}),"Process"]})})(),s.jsx("button",{onClick:()=>_(e),disabled:h===e.eid,className:"p-2 bg-dark-hover hover:bg-red-600/20 text-red-400 rounded-lg transition-colors disabled:opacity-50",title:"Delete episode",children:h===e.eid?s.jsx(n,{size:16,className:"animate-spin"}):s.jsx($,{size:16})})]})]})},e.eid)})})]})}export{te as default};
