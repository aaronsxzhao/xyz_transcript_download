import{j as e}from"./markdown-vhK0I3xZ.js";import{e as F,r as l,L as V}from"./react-vendor-CqdHEJLj.js";import{c as M,t as y,v as $,u as P,L as v,w,x as q,y as A,C as k,q as D}from"./index-DP-uypT4.js";import{A as I}from"./arrow-left-CKD6ohh3.js";import{T as j}from"./tag-CzPars92.js";import{M as x}from"./message-square-DaYXXEWZ.js";import{F as c}from"./file-text-BU7NCz9E.js";import{R as H}from"./refresh-cw-DMpMlfbd.js";import{E as O}from"./external-link-DlO8TeUC.js";import"./syntax-D9IAFz2e.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=M("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);function se(){const{eid:i}=F(),[d,b]=l.useState("summary"),[a,p]=l.useState(null),[r,z]=l.useState(null),[T,N]=l.useState(!0),[o,h]=l.useState(!1),[g,u]=l.useState(new Set);l.useEffect(()=>{i&&S()},[i]);async function S(){N(!0);try{const[s,t]=await Promise.allSettled([y(i),$(i)]);s.status==="fulfilled"&&(p(s.value),s.value.topics.length>0&&u(new Set([s.value.topics[0]]))),t.status==="fulfilled"&&z(t.value)}catch(s){console.error("Failed to load data:",s)}finally{N(!1)}}const n=l.useRef(null),{updateJob:E}=P();l.useEffect(()=>()=>{n.current&&clearInterval(n.current)},[]);async function R(){if(!(!i||o))try{h(!0),p(null);const s=await D(i);E({job_id:s.job_id,status:"pending",progress:0,message:"Re-summarizing...",episode_id:i,episode_title:(a==null?void 0:a.title)||""}),n.current=setInterval(async()=>{try{const t=await y(i);t&&t.topics&&t.topics.length>0&&(p(t),h(!1),t.topics.length>0&&u(new Set([t.topics[0]])),n.current&&(clearInterval(n.current),n.current=null))}catch{}},5e3)}catch(s){console.error("Failed to start re-summarization:",s),alert("Failed to start re-summarization"),h(!1)}}function C(s){const t=new Set(g);t.has(s)?t.delete(s):t.add(s),u(t)}function f(s){const t=Math.floor(s/60),m=Math.floor(s%60);return`${t}:${m.toString().padStart(2,"0")}`}const _=(a==null?void 0:a.key_points.reduce((s,t)=>(s[t.topic]||(s[t.topic]=[]),s[t.topic].push(t),s),{}))||{};return T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-indigo-500"})}):e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{to:"/",className:"p-2 bg-dark-surface border border-dark-border rounded-lg hover:bg-dark-hover transition-colors flex-shrink-0",children:e.jsx(I,{size:20})}),e.jsx("div",{className:"flex-1 min-w-0 sm:hidden",children:e.jsx("h1",{className:"text-lg font-bold text-white line-clamp-2",children:(a==null?void 0:a.title)||"Episode Viewer"})})]}),e.jsxs("div",{className:"flex-1 min-w-0 hidden sm:block",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-white mb-2 line-clamp-2",children:(a==null?void 0:a.title)||"Episode Viewer"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4",children:[a&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-xs md:text-sm text-gray-400",children:[e.jsx(j,{size:14}),a.topics.length," topics"]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-xs md:text-sm text-gray-400",children:[e.jsx(x,{size:14}),a.key_points.length," key points"]})]}),r&&e.jsxs("span",{className:"flex items-center gap-1.5 text-xs md:text-sm text-gray-400",children:[e.jsx(c,{size:14}),f(r.duration)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:flex-shrink-0",children:[e.jsxs("button",{onClick:R,disabled:o||!r,className:"flex items-center gap-2 px-3 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg text-sm transition-colors text-white",title:"Regenerate summary using existing transcript",children:[e.jsx(H,{size:16,className:o?"animate-spin":""}),e.jsx("span",{className:"hidden sm:inline",children:o?"Processing...":"Re-summarize"})]}),e.jsxs("a",{href:`/api/summaries/${i}/html${w()?`?token=${w()}`:""}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-dark-surface border border-dark-border rounded-lg hover:bg-dark-hover text-sm transition-colors",children:[e.jsx(O,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"HTML"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:hidden text-xs text-gray-400",children:[a&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{size:12}),a.topics.length," topics"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{size:12}),a.key_points.length," points"]})]}),r&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(c,{size:12}),f(r.duration)]})]}),e.jsxs("div",{className:"flex gap-1 md:gap-2 border-b border-dark-border",children:[e.jsxs("button",{onClick:()=>b("summary"),className:`flex items-center gap-1.5 md:gap-2 px-3 md:px-4 py-2.5 md:py-3 border-b-2 transition-colors text-sm md:text-base ${d==="summary"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:[e.jsx(x,{size:16,className:"md:w-[18px] md:h-[18px]"}),"Summary"]}),e.jsxs("button",{onClick:()=>b("transcript"),disabled:!r,className:`flex items-center gap-1.5 md:gap-2 px-3 md:px-4 py-2.5 md:py-3 border-b-2 transition-colors text-sm md:text-base disabled:opacity-50 disabled:cursor-not-allowed ${d==="transcript"?"border-indigo-500 text-white":"border-transparent text-gray-400 hover:text-white"}`,children:[e.jsx(c,{size:18}),"Transcript"]})]}),d==="summary"&&o&&!a&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center space-y-4",children:[e.jsx(v,{className:"w-10 h-10 animate-spin text-indigo-500"}),e.jsx("p",{className:"text-lg text-white font-medium",children:"Re-generating summary..."}),e.jsx("p",{className:"text-sm text-gray-400",children:"This may take a minute. The page will update automatically when done."})]}),d==="summary"&&a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 bg-dark-surface border border-dark-border rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(c,{className:"text-indigo-500",size:20}),"Overview"]}),e.jsx("p",{className:"text-gray-300 whitespace-pre-line leading-relaxed",children:a.overview})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(x,{className:"text-purple-500",size:20}),"Key Points by Topic"]}),Object.entries(_).map(([s,t])=>e.jsxs("div",{className:"bg-dark-surface border border-dark-border rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>C(s),className:"w-full flex items-center justify-between p-4 hover:bg-dark-hover transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"text-indigo-400",size:18}),e.jsx("span",{className:"font-medium text-white",children:s}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.length," points)"]})]}),g.has(s)?e.jsx(q,{size:20,className:"text-gray-400"}):e.jsx(A,{size:20,className:"text-gray-400"})]}),g.has(s)&&e.jsx("div",{className:"border-t border-dark-border p-4 space-y-4",children:t.map((m,L)=>e.jsxs("div",{className:"pl-4 border-l-2 border-indigo-500/50",children:[e.jsx("p",{className:"text-gray-200 mb-2",children:m.summary}),m.original_quote&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-dark-hover rounded-lg",children:[e.jsx(Q,{className:"text-gray-500 flex-shrink-0 mt-0.5",size:16}),e.jsx("p",{className:"text-sm text-gray-400 italic",children:m.original_quote})]})]},L))})]},s))]}),a.takeaways.length>0&&e.jsxs("div",{className:"p-6 bg-dark-surface border border-dark-border rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"text-green-500",size:20}),"Takeaways"]}),e.jsx("ul",{className:"space-y-3",children:a.takeaways.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"text-green-500 flex-shrink-0 mt-0.5",size:16}),e.jsx("span",{className:"text-gray-300",children:s})]},t))})]})]}),d==="transcript"&&r&&e.jsxs("div",{className:"p-6 bg-dark-surface border border-dark-border rounded-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(c,{className:"text-blue-500",size:20}),"Full Transcript"]}),r.segments.length>0?e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:r.segments.map((s,t)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("span",{className:"text-xs text-gray-500 font-mono w-12 flex-shrink-0 pt-0.5",children:f(s.start)}),e.jsx("p",{className:"text-gray-300",children:s.text})]},t))}):e.jsx("p",{className:"text-gray-300 whitespace-pre-line leading-relaxed",children:r.text})]}),!a&&!r&&e.jsxs("div",{className:"p-12 bg-dark-surface border border-dark-border rounded-xl text-center",children:[e.jsx(c,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:"No content available"}),e.jsx("p",{className:"text-gray-500",children:"Process this episode to generate transcript and summary"})]})]})}export{se as default};
