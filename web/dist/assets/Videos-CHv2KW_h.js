import{j as e}from"./markdown-vhK0I3xZ.js";import{f as ne,r as o,L as le}from"./react-vendor-CqdHEJLj.js";import{z as oe,x as K,y as X,L as Z,A as de,B as ce,D as me,E as xe,u as q,e as ue,V as S,F as he,G as ge,H as pe,I as H,C as W,J as be,K as fe,T as ve}from"./index-DP-uypT4.js";import{Y as je,S as J}from"./YouTubeCookieGuide-B2HcvLb1.js";import{P as M,a as B,S as ye}from"./PlatformIcon-DWtr9EWW.js";import{A as Ne,S as we}from"./upload-vXZ544xc.js";import{P as ke}from"./play-WWGm0TfV.js";import{A as Ce}from"./arrow-left-CKD6ohh3.js";import{R as ee}from"./refresh-cw-DMpMlfbd.js";import{P as Se}from"./plus-0lhVaYd5.js";import{E as te}from"./external-link-DlO8TeUC.js";import"./syntax-D9IAFz2e.js";const Te=[{id:"bilibili",label:"Bilibili"},{id:"youtube",label:"YouTube"},{id:"douyin",label:"Douyin"},{id:"kuaishou",label:"Kuaishou"},{id:"local",label:"Local File"}],_e=[{id:"minimal",label:"ç²¾ç®€ Minimal"},{id:"detailed",label:"è¯¦ç»† Detailed"},{id:"academic",label:"å­¦æœ¯ Academic"},{id:"tutorial",label:"æ•™ç¨‹ Tutorial"},{id:"xiaohongshu",label:"å°çº¢ä¹¦ Social"},{id:"life_journal",label:"ç”Ÿæ´»å‘ Journal"},{id:"task_oriented",label:"ä»»åŠ¡å¯¼å‘ Tasks"},{id:"business",label:"å•†ä¸š Business"},{id:"meeting_minutes",label:"ä¼šè®®çºªè¦ Minutes"}],Le=[{id:"toc",label:"Table of Contents"},{id:"link",label:"Timestamp Links"},{id:"screenshot",label:"Screenshots"},{id:"summary",label:"AI Summary"}],Pe=[{id:"fast",label:"Fast",sub:"32k"},{id:"medium",label:"Medium",sub:"64k"},{id:"slow",label:"High",sub:"128k"}],ze=[{id:"360",label:"360p"},{id:"480",label:"480p"},{id:"720",label:"720p"},{id:"1080",label:"1080p"},{id:"best",label:"Best"}];function Ue(n){return/bilibili\.com|b23\.tv/i.test(n)}function $(n){return/youtube\.com|youtu\.be/i.test(n)}function Ae({onTaskCreated:n,hideTitle:p}){const b=ne(),[a,d]=o.useState(""),[x,v]=o.useState(""),[j,h]=o.useState("detailed"),[i,t]=o.useState(["toc","summary"]),[c,g]=o.useState("medium"),[N,T]=o.useState("720"),[k,I]=o.useState(""),[y,w]=o.useState(!1),[C,z]=o.useState(4),[_,U]=o.useState(3),[L,r]=o.useState(3),[l,m]=o.useState(!1),[f,G]=o.useState(!1),[A,R]=o.useState(""),[Q,V]=o.useState(""),Y=o.useRef(null),[se,E]=o.useState(!1),O=o.useRef(!1);o.useEffect(()=>{$(a)&&!O.current?(O.current=!0,oe("youtube").then(s=>E(!s.has_cookie)).catch(()=>E(!1))):$(a)||(O.current=!1,E(!1))},[a]);const re=s=>{t(u=>u.includes(s)?u.filter(P=>P!==s):[...u,s])},ae=async s=>{V("Uploading...");try{const u=await de(s);d(u.path),v("local"),V(`Uploaded: ${s.name}`)}catch{V("Upload failed")}},F=o.useRef(!1),ie=async()=>{if(!(!a.trim()||F.current)){F.current=!0,G(!0),R("");try{if(Ue(a.trim()))try{if(!(await ce()).valid){R("BiliBili login required. Please go to Settings â†’ Platform Accounts â†’ BiliBili to log in first.");return}}catch{R("Could not verify BiliBili login status. Please check Settings â†’ Platform Accounts.");return}const s=me(),u=await xe({url:a.trim(),platform:x,style:j,formats:i,quality:c,video_quality:N,llm_model:s.llm_model,extras:k,video_understanding:y,video_interval:C,grid_cols:_,grid_rows:L});n==null||n(u.task_id),d(""),V("")}catch(s){const u=(s==null?void 0:s.message)||"Unknown error";console.error("Failed to generate note:",u),R(u)}finally{G(!1),F.current=!1}}};return e.jsxs("div",{className:"space-y-3",children:[!p&&e.jsx("h3",{className:"text-base font-semibold text-white",children:"Generate Video Notes"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"Platform"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Te.map(s=>e.jsx("button",{onClick:()=>{var u;v(s.id),s.id==="local"&&((u=Y.current)==null||u.click())},className:`px-2.5 py-1 rounded-md text-xs transition-colors ${x===s.id?"bg-indigo-600 text-white":"bg-dark-hover text-gray-400 hover:text-white"}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx(M,{platform:s.id,size:13,className:x===s.id?"text-white":B[s.id]||"text-gray-400"}),s.label]})},s.id))}),e.jsx("input",{ref:Y,type:"file",accept:"video/*",className:"hidden",onChange:s=>{var P;const u=(P=s.target.files)==null?void 0:P[0];u&&ae(u)}}),Q&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Q})]}),x!=="local"&&e.jsx("input",{type:"text",value:a,onChange:s=>d(s.target.value),placeholder:"Paste video URL here...",className:"w-full px-3 py-2.5 bg-dark-hover border border-dark-border rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-indigo-500"}),se&&$(a)&&e.jsxs("div",{className:"flex items-start gap-2 p-2.5 bg-amber-900/20 border border-amber-500/30 rounded-lg",children:[e.jsx(Ne,{size:14,className:"text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-amber-300/90",children:[e.jsx("p",{className:"font-medium",children:"YouTube cookies not set"}),e.jsxs("p",{className:"mt-0.5 text-amber-300/70",children:["YouTube may block requests from cloud servers. Upload cookies in"," ",e.jsx("button",{onClick:()=>b("/settings"),className:"text-indigo-400 hover:text-indigo-300 underline",children:"Settings â†’ Platform Accounts"})," ","to avoid failures."]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"Note Style"}),e.jsx("select",{value:j,onChange:s=>h(s.target.value),className:"w-full px-3 py-2 bg-dark-hover border border-dark-border rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500",children:_e.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"Include"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Le.map(s=>e.jsxs("label",{className:`px-3 py-1.5 rounded-lg text-xs cursor-pointer transition-colors whitespace-nowrap ${i.includes(s.id)?"bg-indigo-600/20 text-indigo-400 border border-indigo-500/50":"bg-dark-hover text-gray-400 border border-transparent hover:text-white"}`,children:[e.jsx("input",{type:"checkbox",checked:i.includes(s.id),onChange:()=>re(s.id),className:"hidden"}),s.label]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"Audio Quality"}),e.jsx("div",{className:"flex gap-1.5",children:Pe.map(s=>e.jsxs("button",{onClick:()=>g(s.id),className:`flex-1 flex flex-col items-center py-2 rounded-lg text-xs transition-colors ${c===s.id?"bg-indigo-600 text-white":"bg-dark-hover text-gray-400 hover:text-white"}`,children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("span",{className:`text-[10px] mt-0.5 ${c===s.id?"text-indigo-200":"text-gray-500"}`,children:s.sub})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5",children:"Video Quality"}),e.jsx("div",{className:"flex gap-1.5",children:ze.map(s=>e.jsx("button",{onClick:()=>T(s.id),className:`flex-1 py-2 rounded-lg text-xs text-center transition-colors ${N===s.id?"bg-indigo-600 text-white font-medium":"bg-dark-hover text-gray-400 hover:text-white"}`,children:s.label},s.id))})]}),e.jsxs("button",{onClick:()=>m(!l),className:"flex items-center gap-1.5 text-xs text-gray-500 hover:text-white transition-colors",children:[e.jsx(ye,{size:12}),"Advanced Options",l?e.jsx(K,{size:12}):e.jsx(X,{size:12})]}),l&&e.jsxs("div",{className:"p-3 bg-dark-hover/50 border border-dark-border rounded-lg space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:s=>w(s.target.checked),className:"rounded bg-dark-hover border-dark-border text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-xs text-gray-300",children:"Multimodal Video Understanding"})]}),y&&e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-gray-500 mb-1",children:"Interval (s)"}),e.jsx("input",{type:"number",min:1,max:30,value:C,onChange:s=>z(parseInt(s.target.value)||4),className:"w-full px-2 py-1.5 bg-dark-hover border border-dark-border rounded-lg text-xs text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-gray-500 mb-1",children:"Grid Cols"}),e.jsx("input",{type:"number",min:1,max:5,value:_,onChange:s=>U(parseInt(s.target.value)||3),className:"w-full px-2 py-1.5 bg-dark-hover border border-dark-border rounded-lg text-xs text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-gray-500 mb-1",children:"Grid Rows"}),e.jsx("input",{type:"number",min:1,max:5,value:L,onChange:s=>r(parseInt(s.target.value)||3),className:"w-full px-2 py-1.5 bg-dark-hover border border-dark-border rounded-lg text-xs text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] text-gray-500 mb-1",children:"Extra Instructions"}),e.jsx("textarea",{value:k,onChange:s=>I(s.target.value),placeholder:"Additional instructions for the AI...",rows:2,className:"w-full px-2 py-1.5 bg-dark-hover border border-dark-border rounded-lg text-xs text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 resize-none"})]})]}),A&&e.jsxs("div",{className:"p-3 bg-red-900/30 border border-red-500/50 rounded-lg text-xs text-red-300",children:[e.jsx("p",{children:A}),A.toLowerCase().includes("login")&&$(a)&&e.jsx("div",{className:"mt-3 p-3 bg-dark-hover rounded-lg border border-dark-border",children:e.jsx(je,{compact:!0})}),A.includes("Settings")&&e.jsx("button",{onClick:()=>b("/settings"),className:"mt-1.5 text-indigo-400 hover:text-indigo-300 underline text-xs",children:"Open Settings"})]}),e.jsx("button",{onClick:ie,disabled:f||!a.trim(),className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-700 disabled:text-gray-500 text-white rounded-lg font-medium text-sm transition-colors",children:f?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:16,className:"animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{size:16}),"Generate Notes"]})})]})}const D={bilibili:{label:"Bilibili"},youtube:{label:"YouTube"},douyin:{label:"æŠ–éŸ³"},kuaishou:{label:"å¿«æ‰‹"},local:{label:"Local"}};function Je(){var U,L;const{videoTasks:n,setVideoTasks:p,removeVideoTask:b}=q(),[a,d]=o.useState(!1),[x,v]=o.useState(""),[j,h]=o.useState(!1),[i,t]=o.useState({type:"platforms"}),c=o.useCallback(async()=>{h(!0);try{const r=await ue();p(r.tasks)}catch(r){console.error("Failed to load tasks:",r)}finally{h(!1)}},[p]),g=n.some(r=>!["success","failed","cancelled"].includes(r.status));o.useEffect(()=>{c();const r=setInterval(c,g?5e3:3e4);return()=>clearInterval(r)},[c,g]);const N=r=>{q.getState().updateVideoTask({id:r,url:"",platform:"",title:"",thumbnail:"",channel:"",channel_url:"",channel_avatar:"",status:"pending",progress:0,message:"Queued for processing...",markdown:"",transcript:null,style:"",model:"",formats:[],quality:"",extras:"",video_understanding:!1,video_interval:4,grid_cols:3,grid_rows:3,duration:0,error:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),d(!1)},T=async r=>{try{await he(r),b(r)}catch(l){console.error("Delete failed:",l)}},k=async r=>{try{await ge(r),c()}catch(l){console.error("Retry failed:",l)}},I=async r=>{try{await pe(r),c()}catch(l){console.error("Cancel failed:",l)}},y=o.useMemo(()=>{if(!x)return n;const r=x.toLowerCase();return n.filter(l=>l.title.toLowerCase().includes(r)||l.url.toLowerCase().includes(r)||l.channel.toLowerCase().includes(r))},[n,x]),w=o.useMemo(()=>{const r={};for(const l of y){const m=l.platform||"other";r[m]||(r[m]={total:0,done:0}),r[m].total++,l.status==="success"&&r[m].done++}return r},[y]),C=o.useMemo(()=>{const r=["bilibili","youtube","douyin","kuaishou","local"];return Object.keys(w).sort((l,m)=>(r.indexOf(l)===-1?99:r.indexOf(l))-(r.indexOf(m)===-1?99:r.indexOf(m)))},[w]),z=r=>{const l={};for(const m of y){if((m.platform||"other")!==r)continue;const f=m.channel||"Unknown Channel";l[f]||(l[f]={count:0,done:0,tasks:[]}),l[f].count++,l[f].tasks.push(m),m.status==="success"&&l[f].done++}return l},_=(r,l)=>y.filter(m=>(m.platform||"other")===r&&(m.channel||"Unknown Channel")===l);return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i.type!=="platforms"&&e.jsx("button",{onClick:()=>{i.type==="videos"?t({type:"channels",platform:i.platform}):t({type:"platforms"})},className:"p-1.5 text-gray-400 hover:text-white transition-colors",children:e.jsx(Ce,{size:18})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-white",children:[i.type==="platforms"&&"Videos",i.type==="channels"&&(((U=D[i.platform])==null?void 0:U.label)||i.platform),i.type==="videos"&&i.channel]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[i.type==="platforms"&&`${n.length} video note${n.length!==1?"s":""}`,i.type==="channels"&&`${((L=w[i.platform])==null?void 0:L.total)||0} videos`,i.type==="videos"&&`${_(i.platform,i.channel).length} videos`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:c,disabled:j,className:"p-2 bg-dark-surface border border-dark-border rounded-lg hover:bg-dark-hover transition-colors text-gray-400",children:e.jsx(ee,{size:16,className:j?"animate-spin":""})}),e.jsxs("button",{onClick:()=>d(!a),className:"flex items-center gap-2 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors",children:[e.jsx(Se,{size:16})," New Video Note"]})]})]}),a&&e.jsxs("div",{className:"bg-dark-surface rounded-xl border border-dark-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pt-3 pb-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Generate Video Notes"}),e.jsx("button",{onClick:()=>d(!1),className:"p-1 text-gray-500 hover:text-white transition-colors",children:e.jsx(K,{size:16})})]}),e.jsx("div",{className:"px-4 pb-4 pt-2 max-h-[50vh] overflow-y-auto custom-scrollbar",children:e.jsx(Ae,{onTaskCreated:N,hideTitle:!0})})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(we,{size:16,className:"absolute left-3 top-2.5 text-gray-500"}),e.jsx("input",{type:"text",value:x,onChange:r=>v(r.target.value),placeholder:"Search videos, channels...",className:"w-full pl-9 pr-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-sm text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500"})]}),C.length>0&&e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:[e.jsxs("button",{onClick:()=>t({type:"platforms"}),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap transition-colors ${i.type==="platforms"?"bg-indigo-600 text-white":"bg-dark-surface border border-dark-border text-gray-400 hover:text-white hover:bg-dark-hover"}`,children:["All (",y.length,")"]}),C.map(r=>{const l=D[r]||{label:r},m=w[r],f=(i.type==="channels"||i.type==="videos")&&i.platform===r;return e.jsxs("button",{onClick:()=>t({type:"channels",platform:r}),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap transition-colors ${f?"bg-indigo-600 text-white":"bg-dark-surface border border-dark-border text-gray-400 hover:text-white hover:bg-dark-hover"}`,children:[e.jsx(M,{platform:r,size:15,className:f?"text-white":B[r]||"text-gray-400"}),l.label,e.jsxs("span",{className:"text-xs opacity-70",children:["(",m.total,")"]})]},r)})]}),n.length===0?e.jsxs("div",{className:"p-12 bg-dark-surface border border-dark-border rounded-xl text-center",children:[e.jsx(S,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:"No video notes yet"}),e.jsx("p",{className:"text-gray-500",children:"Create a new video note to get started"})]}):i.type==="platforms"?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(r=>{const l=D[r]||{label:r},m=w[r],f=Object.keys(z(r));return e.jsxs("button",{onClick:()=>t({type:"channels",platform:r}),className:"p-5 bg-dark-surface border border-dark-border rounded-xl hover:border-indigo-500/50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(M,{platform:r,size:28,className:B[r]||"text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:l.label})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsxs("span",{children:[f.length," channel",f.length!==1?"s":""]}),e.jsxs("span",{children:[m.done,"/",m.total," completed"]})]})]},r)})}):i.type==="channels"?e.jsx(Re,{channels:z(i.platform),onSelectChannel:r=>t({type:"videos",platform:i.platform,channel:r})}):e.jsx(Ie,{videos:_(i.platform,i.channel),onDelete:T,onRetry:k,onCancel:I})]})}function Re({channels:n,onSelectChannel:p}){const b=Object.keys(n).sort((a,d)=>a==="Unknown Channel"?1:d==="Unknown Channel"?-1:n[d].count-n[a].count);return b.length===0?e.jsxs("div",{className:"p-12 bg-dark-surface border border-dark-border rounded-xl text-center",children:[e.jsx(S,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:"No channels found"}),e.jsx("p",{className:"text-gray-500",children:"Process some videos to see channels here"})]}):e.jsx("div",{className:"space-y-4",children:b.map(a=>{var j;const d=n[a],x=d.tasks.reduce((h,i)=>new Date(i.updated_at)>new Date(h.updated_at)?i:h,d.tasks[0]),v=(j=d.tasks.filter(h=>h.status==="success").sort((h,i)=>new Date(i.updated_at).getTime()-new Date(h.updated_at).getTime())[0])==null?void 0:j.title;return e.jsx("div",{className:"p-4 md:p-6 bg-dark-surface border border-dark-border rounded-xl hover:border-dark-hover transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0 cursor-pointer",onClick:()=>p(a),children:[(()=>{var c;const h=(c=d.tasks.find(g=>g.channel_avatar))==null?void 0:c.channel_avatar,i=x==null?void 0:x.thumbnail,t=h||i;return t?e.jsx("img",{src:t,alt:"",className:`w-14 h-14 md:w-20 md:h-20 flex-shrink-0 bg-dark-hover object-cover ${h?"rounded-full":"rounded-lg"}`,onError:g=>{g.target.style.display="none"},referrerPolicy:"no-referrer"}):e.jsx("div",{className:"w-14 h-14 md:w-20 md:h-20 rounded-full bg-dark-hover flex items-center justify-center flex-shrink-0",children:e.jsx(S,{className:"w-6 h-6 md:w-8 md:h-8 text-gray-600"})})})(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base md:text-lg font-semibold text-white mb-1 line-clamp-2",children:a}),v&&e.jsxs("p",{className:"text-sm text-gray-500 line-clamp-1 hidden sm:block",children:["Latest: ",v]}),e.jsx("p",{className:"text-sm text-indigo-400 mt-1 md:mt-2",children:d.done>0?`${d.done} / ${d.count} completed`:`${d.count} video${d.count!==1?"s":""}`})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:[e.jsxs("button",{onClick:()=>p(a),className:"flex items-center gap-1 px-3 py-2 bg-dark-hover hover:bg-dark-border text-white rounded-lg transition-colors text-sm",children:[e.jsx(S,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Videos"})]}),(x==null?void 0:x.channel_url)&&e.jsx("a",{href:x.channel_url,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-dark-hover hover:bg-dark-border text-white rounded-lg transition-colors",title:"Open channel page",children:e.jsx(te,{size:16})})]})]})},a)})})}function Ve(n){if(n.title&&n.title!=="Untitled")return n.title;if(n.url)try{const p=new URL(n.url),b=p.hostname.replace("www.",""),a=p.pathname.replace(/\/$/,""),d=a.length>40?"..."+a.slice(-37):a;return`${b}${d}`}catch{return n.url.length>60?n.url.slice(0,57)+"...":n.url}return"Untitled"}function $e(n){const p=(n.error||"").toLowerCase(),b=(n.message||"").toLowerCase(),a=p+" "+b;return a.includes("login")||a.includes("cookie")||a.includes("403")||a.includes("sign in")||a.includes("412")?"This video may require login. Go to Settings â†’ Platform Accounts and upload cookies or scan QR code for this platform.":a.includes("not found")||a.includes("404")||a.includes("unavailable")||a.includes("removed")?"The video could not be found or is no longer available. Check the URL and try again.":a.includes("geo")||a.includes("region")||a.includes("country")?"This video may be region-restricted. Try using a VPN or a different region.":a.includes("private")?"This video is private. Make sure you have access and upload platform cookies in Settings.":a.includes("age")||a.includes("restricted")?"This video is age-restricted. Upload platform cookies in Settings to verify your account.":a.includes("timeout")||a.includes("timed out")?"The request timed out. Try again later or check your connection.":a.includes("copyright")||a.includes("blocked")?"This video is blocked due to copyright. It cannot be processed.":a.includes("rate limit")||a.includes("429")?"Too many requests. Wait a few minutes and try again.":a.includes("unsupported")?"This URL format is not supported. Check the URL and try again.":"Something went wrong. Try again, or check Settings â†’ Platform Accounts if the video requires login."}function Ie({videos:n,onDelete:p,onRetry:b,onCancel:a}){const d=t=>`${Math.floor(t/60)} min`,x=t=>({pending:"Pending",parsing:"Parsing",downloading:"Downloading",transcribing:"Transcribing",summarizing:"Summarizing",saving:"Saving",success:"Done",failed:"Failed",cancelled:"Cancelled"})[t]||t,v=t=>!["success","failed","pending","cancelled"].includes(t),[j,h]=o.useState(new Set),i=t=>{h(c=>{const g=new Set(c);return g.has(t)?g.delete(t):g.add(t),g})};return n.length===0?e.jsxs("div",{className:"p-12 bg-dark-surface border border-dark-border rounded-xl text-center",children:[e.jsx(S,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-400 mb-2",children:"No videos in this channel"}),e.jsx("p",{className:"text-gray-500",children:"Process some videos to see them here"})]}):e.jsx("div",{className:"space-y-3",children:n.map(t=>{const c=t.status==="failed",g=t.error||t.message||"",N=c?$e(t):null,T=Ve(t);return e.jsx("div",{className:`p-3 md:p-4 bg-dark-surface border rounded-xl transition-colors ${c?"border-red-500/30 hover:border-red-500/50":"border-dark-border hover:border-dark-hover"}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-3 md:gap-4",children:[t.thumbnail?e.jsx("img",{src:t.thumbnail,alt:"",className:"w-full sm:w-40 md:w-48 h-24 sm:h-24 md:h-28 rounded-lg object-cover flex-shrink-0 bg-dark-hover",onError:k=>{k.target.style.display="none"},referrerPolicy:"no-referrer"}):e.jsx("div",{className:`hidden sm:flex w-40 md:w-48 h-24 md:h-28 rounded-lg items-center justify-center flex-shrink-0 ${c?"bg-red-500/10":"bg-dark-hover"}`,children:c?e.jsx(H,{className:"w-8 h-8 text-red-500/50"}):e.jsx(S,{className:"w-8 h-8 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-white mb-1 line-clamp-2 text-sm md:text-base",children:T}),(!t.title||t.title==="Untitled")&&t.url&&e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-indigo-400 hover:text-indigo-300 mb-1 truncate",children:[e.jsx(te,{size:10,className:"flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.url})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-xs md:text-sm text-gray-400",children:[t.created_at&&e.jsx("span",{children:t.created_at.slice(0,10)}),t.duration>0&&e.jsx("span",{children:d(t.duration)}),t.status==="success"&&e.jsxs("span",{className:"flex items-center gap-1 text-green-500",children:[e.jsx(W,{size:12,className:"md:w-3.5 md:h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Completed"})]}),t.status==="failed"&&e.jsxs("button",{onClick:()=>i(t.id),className:"flex items-center gap-1 text-red-500 hover:text-red-400 transition-colors",children:[e.jsx(H,{size:12,className:"md:w-3.5 md:h-3.5"}),"Failed",e.jsx(X,{size:12,className:`transition-transform ${j.has(t.id)?"rotate-180":""}`})]}),t.status==="cancelled"&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-400",children:[e.jsx(J,{size:12,className:"md:w-3.5 md:h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancelled"})]}),t.status==="pending"&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(be,{size:12,className:"md:w-3.5 md:h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Pending"})]})]}),c&&g&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:`text-xs text-red-400/80 ${j.has(t.id)?"":"line-clamp-1"}`,children:g}),N&&e.jsxs("p",{className:"mt-1.5 text-xs text-amber-400/80 flex items-start gap-1.5",children:[e.jsx("span",{className:"flex-shrink-0 mt-0.5",children:"ðŸ’¡"}),e.jsx("span",{children:N})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:[t.status==="success"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>b(t.id),className:"flex items-center gap-2 px-3 py-2 bg-dark-hover hover:bg-dark-border text-gray-300 rounded-lg transition-colors",title:"Re-process video",children:[e.jsx(ee,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Re-Process"})]}),e.jsxs(le,{to:`/videos/${t.id}`,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:[e.jsx(W,{size:16}),"View"]})]}):v(t.status)?e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-dark-hover rounded-lg min-w-[140px]",children:[e.jsx(Z,{size:16,className:"animate-spin text-indigo-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:t.progress>0?`${x(t.status)} ${Math.round(t.progress)}%`:x(t.status)}),e.jsx("div",{className:"h-1.5 bg-dark-border rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${Math.min(t.progress,100)}%`}})})]})]}):e.jsxs("button",{onClick:()=>b(t.id),className:"flex items-center gap-2 px-4 py-2 bg-dark-hover hover:bg-dark-border text-white rounded-lg transition-colors",children:[e.jsx(fe,{size:16}),"Retry"]}),!v(t.status)&&e.jsx("button",{onClick:()=>p(t.id),className:"p-2 bg-dark-hover hover:bg-red-600/20 text-red-400 rounded-lg transition-colors",title:"Delete video",children:e.jsx(ve,{size:16})}),v(t.status)&&e.jsx("button",{onClick:()=>a(t.id),className:"p-2 bg-dark-hover hover:bg-orange-600/20 text-orange-400 rounded-lg transition-colors",title:"Cancel processing",children:e.jsx(J,{size:16,className:"fill-current"})})]})]})},t.id)})})}export{Je as default};
