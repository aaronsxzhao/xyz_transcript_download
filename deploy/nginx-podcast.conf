# =============================================================================
# Nginx Reverse Proxy Config for Podcast Tool
# =============================================================================
# 
# SETUP INSTRUCTIONS:
#   1. Replace YOUR_DOMAIN.COM with your actual domain (2 places below)
#   2. Copy to nginx:
#        sudo cp deploy/nginx-podcast.conf /etc/nginx/sites-available/podcast
#   3. Enable:
#        sudo ln -s /etc/nginx/sites-available/podcast /etc/nginx/sites-enabled/
#   4. Remove default site (optional):
#        sudo rm /etc/nginx/sites-enabled/default
#   5. Test & reload:
#        sudo nginx -t && sudo systemctl reload nginx
#   6. Add SSL:
#        sudo certbot --nginx -d YOUR_DOMAIN.COM -d www.YOUR_DOMAIN.COM
#
# =============================================================================

server {
    listen 80;
    server_name YOUR_DOMAIN.COM www.YOUR_DOMAIN.COM;

    # Gzip compression â€” critical for JS/CSS bundle performance
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_min_length 256;
    gzip_types text/plain text/css text/javascript application/javascript application/json application/xml image/svg+xml;

    # Proxy all requests to the Docker container
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_http_version 1.1;

        # WebSocket support (required for real-time progress updates)
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # Pass real client info to the app
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Long timeouts for audio processing (transcription can take 10+ minutes)
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;

        # Allow large uploads (audio files)
        client_max_body_size 500M;
    }

    # Health check endpoint (for monitoring)
    location /api/health {
        proxy_pass http://127.0.0.1:8080/api/health;
        proxy_set_header Host $host;
        access_log off;
    }
}
